<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Talking In Pictures Reading Programme</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f0f0f0;
      text-align: center;
      padding: 20px;
    }
    img {
      max-height: 200px;
    }
    .hidden {
      display: none;
    }
    #initialLetter {
      font-size: 72px;
      font-weight: bold;
      margin: 10px 0;
    }
    #symbolEl {
      font-size: 48px;
      margin-top: 10px;
    }
    #feedbackEl {
      font-size: 20px;
      color: green;
    }
    #summaryTable {
      text-align: left;
      margin: 0 auto;
      max-width: 400px;
    }
    input[type="text"] {
      font-size: 24px;
      padding: 10px;
    }
    button {
      font-size: 20px;
      padding: 10px 20px;
      margin: 10px;
    }
  </style>
</head>
<body>

  <a href="https://www.talkinginpictures.co.uk">
    <img src="https://www.talkinginpictures.co.uk/tip-logo.png" alt="Talking in Pictures Logo" height="80">
  </a>
  <h1>Reading Programme</h1>

  <div id="gameArea">
    <p id="promptEl"></p>
    <img id="imageEl" src="" alt="Prompt image"><br>
    <div class="word-display">
      <strong id="wordUpper"></strong><br>
      <em id="wordLower"></em>
    </div>
    <div id="initialLetter"></div>
    <input id="answerEl" type="text" autocomplete="off"><br>
    <p id="feedbackEl"></p>
    <p id="symbolEl"></p>
  </div>

  <div id="congratsScreen" class="hidden">
    <p class="congrats">ðŸŽ‰ Congratulations! You completed the round!</p>
    <div id="summaryTable"></div>
    <p id="summaryAttempts"></p>
    <p id="summaryCorrect"></p>
    <p id="summaryAccuracy"></p>
    <p id="summaryTime"></p>
    <button onclick="startNextRound()">Start Next Round</button>
  </div>

  <script>
// === INITIAL VARIABLES ===
let phase = "alphabet";
let round = 1;
let current = 0;
let correctCount = 0;
let totalCount = 0;
let startTime = Date.now();
let errorlessMode = false;
let speechOn = true;
let allProgress = [];

const promptEl = document.getElementById("promptEl");
const wordUpper = document.getElementById("wordUpper");
const wordLower = document.getElementById("wordLower");
const initialLetter = document.getElementById("initialLetter");
const answerEl = document.getElementById("answerEl");
const feedbackEl = document.getElementById("feedbackEl");
const symbolEl = document.getElementById("symbolEl");
const imageEl = document.getElementById("imageEl");
const gameArea = document.getElementById("gameArea");
const congratsScreen = document.getElementById("congratsScreen");
const summaryTable = document.getElementById("summaryTable");
const summaryAttempts = document.getElementById("summaryAttempts");
const summaryCorrect = document.getElementById("summaryCorrect");
const summaryAccuracy = document.getElementById("summaryAccuracy");
const summaryTime = document.getElementById("summaryTime");

const wordSets = {
  1: ["apple", "dog", "ball", "car", "fish", "egg", "goat", "hat", "ice", "jug", "kite", "lion", "moon", "net", "owl", "pen", "queen", "rat", "sun", "top", "urn", "van", "web", "xray", "yak", "zebra"],
  2: ["ant", "bat", "cup", "dig", "ear", "fan", "gum", "hop", "ink", "jam", "kid", "log", "man", "nap", "oil", "pit", "quip", "rug", "sip", "tip", "use", "vet", "wig", "box", "yarn", "zip"],
  3: ["frog", "milk", "ship", "book", "lamp", "star", "duck", "nest", "ball", "tree"],
  4: ["apple", "chair", "grape", "plant", "train", "snake", "cloud", "light", "brick", "smile"],
  5: ["rabbit", "guitar", "button", "silver", "orange", "bridge", "castle", "pencil", "market", "forest"],
  6: ["picture", "teacher", "blanket", "student", "printer", "glasses", "balloon", "sandbox", "cabinet", "monster"],
  7: ["elephant", "sandwich", "umbrella", "dinosaur", "notebook", "hospital", "football", "building", "magazine", "airplane"],
  8: ["chocolate", "pineapple", "volunteer", "nightmare", "storybook", "blueberry", "astronaut", "adventure", "campfire", "lighthouse"],
  9: ["strawberry", "vegetables", "playground", "motorcycle", "backpacker", "watermelon", "newspaper", "telescope", "librarian", "toothbrush"],
  10: ["playfulness", "multiverse", "volleyballs", "breathtaking", "sailboarding", "friendliest", "expressions", "magnificent", "photographs", "windbreaker"]
};

let currentSet = [];

function speakPrompt(text) {
  if (!speechOn) return;
  const utter = new SpeechSynthesisUtterance(text);
  speechSynthesis.speak(utter);
}

function updateDisplays(word) {
  wordUpper.textContent = word.toUpperCase();
  wordLower.textContent = word.toLowerCase();
  initialLetter.textContent = phase === "alphabet" ? word[0].toUpperCase() : "";
  initialLetter.style.color = "black";
}

function preload(set) {
  currentSet = set;
  current = 0;
  startTime = Date.now();
  loadWord(current);
}

function updateSummary() {
  const acc = totalCount ? Math.round((correctCount / totalCount) * 100) : 0;
  const elapsed = Math.floor((Date.now() - startTime) / 1000);
  summaryAttempts.textContent = `Total Attempts: ${totalCount}`;
  summaryCorrect.textContent = `Correct Answers: ${correctCount}`;
  summaryAccuracy.textContent = `Accuracy: ${acc}%`;
  summaryTime.textContent = `Round Time: ${elapsed}s`;
  allProgress.push({ round, phase, correct: correctCount, total: totalCount, time: elapsed });
}

function showSummaryTable() {
  summaryTable.innerHTML = '<h3>Progress Summary</h3>' +
    allProgress.map(r => `<p><strong>Round ${r.round} (${r.phase})</strong><br>Score: ${r.correct}/${r.total} | Accuracy: ${Math.round((r.correct / r.total) * 100)}% | Time: ${r.time}s</p>`).join('');
}

function startNextRound() {
  round++;
  if (!wordSets[round]) {
    alert("ðŸŽ‰ All rounds complete!");
    return;
  }
  phase = `round${round}`;
  correctCount = 0;
  totalCount = 0;
  gameArea.style.display = 'block';
  congratsScreen.classList.add("hidden");
  preload(wordSets[round]);
}

function loadWord(index) {
  if (index >= currentSet.length || index >= 10) {
    gameArea.style.display = 'none';
    congratsScreen.classList.remove("hidden");
    updateSummary();
    showSummaryTable();
    return;
  }
  const word = currentSet[index];
  const imageURL = `https://static.arasaac.org/pictograms/${word}.png`;
  updateDisplays(word);
  imageEl.src = imageURL;
  imageEl.onerror = () => imageEl.src = "https://via.placeholder.com/150?text=Image";
  feedbackEl.textContent = "";
  symbolEl.textContent = "";
  promptEl.textContent = phase === "alphabet" ? `What letter does ${word.toUpperCase()} begin with?` : `Type the word: ${word}`;
  speakPrompt(promptEl.textContent);
  answerEl.value = "";
}

answerEl.addEventListener("input", () => {
  const word = currentSet[current];
  const val = answerEl.value.toLowerCase();
  if (errorlessMode && phase !== "alphabet" && val !== word.slice(0, val.length)) {
    answerEl.value = val.slice(0, -1);
    return;
  }
  if (phase === "alphabet") {
    if (val.length === 1) {
      totalCount++;
      if (val === word[0].toLowerCase()) {
        correctCount++;
        feedbackEl.textContent = "âœ… Correct!";
        symbolEl.textContent = `ðŸŽ = ${word}`;
        setTimeout(() => loadWord(++current), 1000);
      } else {
        feedbackEl.textContent = "âŒ Try again";
        initialLetter.style.color = "red";
      }
    }
  } else {
    if (val === word) {
      totalCount++;
      correctCount++;
      feedbackEl.textContent = "âœ… Great job!";
      symbolEl.textContent = `ðŸŽ‰ ${word.toUpperCase()}!`;
      setTimeout(() => loadWord(++current), 1000);
    }
  }
});

// Initial start
preload(wordSets[1]);
</script>

</body>
</html>
